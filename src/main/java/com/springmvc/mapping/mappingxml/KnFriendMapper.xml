<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.springmvc.mapping.KnFriendMapper">
  <resultMap id="BaseResultMap" type="com.springmvc.pojo.KnFriend">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 05 18:04:04 CST 2019.
    -->
    <id column="id" jdbcType="SMALLINT" property="id" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="url" jdbcType="VARCHAR" property="url" />
    <result column="img" jdbcType="VARCHAR" property="img" />
    <result column="level" jdbcType="TINYINT" property="level" />
    <result column="add_time" jdbcType="TIMESTAMP" property="addTime" />
    <result column="enrollment" jdbcType="INTEGER" property="enrollment" />
  </resultMap>

  <!--* Description：得到推广列表
     *
     * @param , response, pageNo：当前页, pageSize：页容量,title:产品名称，Index1排序方式，propertyId产品属性，statusId审核状态-->
  <select id="selectFriend" parameterType="kn_friend" resultType="kn_friend">
    select * from kn_friend
    <where>
      <if test="title!=null and title!='' ">
        AND  title  LIKE '%${title}%'
      </if>
    </where>
    <if test="addTime!=null and addTime!='' ">
      ORDER BY add_time
    </if>
    <if test="click!=null and click!='' ">
      ORDER BY click DESC
    </if>
    <if test="level!=null and level!='' ">
      ORDER BY `level` DESC
    </if>
  </select>

  <select id="selectAlllAndFriend" resultType="kn_friend">
    SELECT * FROM kn_friend
  </select>

  <delete id="deleteFriend" parameterType="int">
  DELETE FROM kn_friend WHERE id=#{id}
  </delete>

  <update id="updateFrilend" parameterType="kn_friend" >
  UPDATE  kn_friend
    <trim prefix="set" suffixOverrides=",">
      <if test="title!=null and title!='' ">
      title=#{title},
      </if>
      <if test="url!=null and url!='' ">
        url=#{url},
      </if>
      <if test="pv!=null and pv!='' ">
        pv=#{pv},
      </if>
      <if test="uv!=null and uv!='' ">
        uv=#{uv},
      </if>
      <if test="longUrl!=null and longUrl!= ''">
      long_url=#{longUrl}
      </if>
    </trim>
    WHERE id=#{id}
  </update>

  <select id="selectFrilend" parameterType="int" resultType="kn_friend">
    SELECT * FROM kn_friend WHERE id=#{id}
  </select>

  <insert id="insertFrilend" parameterType="kn_friend">
  insert into kn_friend
  <trim prefix="(" suffix=")" suffixOverrides=",">
  <if test="title!=null and title!='' ">
    title,
  </if>
    <if test="url!=null and url!='' ">
     `url`,
    </if>
    <if test="addTime!=null and addTime!='' ">
      add_time,
    </if>
    <if test="shortUrl!=null and shortUrl!='' ">
      short_url,
    </if>
    <if test="longUrl!=null and longUrl!='' ">
      long_url,
    </if>
  </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
    <if test="title!=null and title!='' ">
      #{title},
    </if>
      <if test="url!=null and url!='' ">
        #{url},
      </if>
      <if test="addTime!=null and addTime!='' ">
        #{addTime},
      </if>
      <if test="shortUrl!=null and shortUrl!='' ">
        #{shortUrl},
      </if>
      <if test="longUrl!=null and longUrl!='' ">
        #{longUrl},
      </if>
    </trim>
  </insert>


  <!--推广链接注册埋点+1-->
  <update id="updateFriendZhuce" parameterType="String">
   update `kn_friend` set enrollment=enrollment+1 where short_url = #{shortUrl}
  </update>

  <!--查询所有推广链接-->
  <select id="selectFriendAll" resultType="kn_friend">
  SELECT * FROM kn_friend
  </select>

  <!--查询短链接-->
  <select id="selectShortUrl" resultType="kn_friend">
    select  id,short_url FROM kn_friend
  </select>

    <!--根据短链接查询真实路径-->
    <select id="restoreUrl" resultType="String">
        SELECT long_url FROM  kn_friend WHERE short_url=#{shortUrl}
    </select>

</mapper>